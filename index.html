<!DOCTYPE html>
<html>
<head>
	<title>Fractals of Arkadiusz Jadczyk</title>
	<style type="text/css">
	#progress_bar {
		width: 0px;
		height: 12px;
		display: none;
		background-color: #333;
		color: white;
		font-weight: bolder;
		font-size: 11px;
		text-align: center;
	}
	#saveable {
		position: absolute;
		top: 5%;
		left: 10%;
		background-color: black;
		border: 2px solid white;
		display: none;
	}
	#markov_options {
		display: none;
	}
	#markov_options p {
		float: left;
		margin-right: 10px;
	}
	.progress-bar-container {
		border: 1px solid #333;
		height: 12px;
		width: 100%;
	}
	</style>
</head>
<body>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="array.js"></script>
	<script type="text/javascript" src="math.js"></script>
	<script type="text/javascript" src="colors.js"></script>
	<script type="text/javascript" src="canvas.js"></script>
	
	<table>
		<tr>
			<td valign="top">
				<canvas id="fractalCanvas" width="600px" height="600px"></canvas>
			</td>
		</tr>
		<tr>
				<td valign="top" >
				<div class="progress-bar-container">
					<div id="progress_bar">&nbsp;</div>
				</div>
					
				</td>
			</tr>
		<tr>
			<td valign="top">
				
			<table>
				<tr>
					<td align="right">
						<button id="generate">Generate</button>
						<button id="redraw_button">Redraw</button>
						<button id="save_button">Save Image</button>
					</td>
				</tr>
				<tr>
					<td valign="top">
						<p>
							<label>Alpha</label><br />
							<input type="text" id="alpha" value="0.77" /> <br />
							<label>Velocity</label><br />
							<input type="text" id="velocity" value="0.77" />
						</p>
					</td>
					<td valign="top">
						<p>
							<label>Iterations</label> <br />
							<input type="text" id="iterations" value="100000" />
							<br />
							<label>Algorithm</label> <br />
							<select id="fractal_algorithm">
								<option selected="selected" value="icosa">Icosa</option>
								<option value="markov">Markov</option>
							</select>
						</p>
					</td>
					<td valign="top">
						<p>
							<label>Type</label> <br />
							<select id="fractal_type">
								<option>Para</option>
								<option>PlatonicCube</option>
								<option>PlatonicDodeca</option>
								<option selected="selected">PlatonicIcosa</option>
								<option>PlatonicOcta</option>
								<option>PlatonicTetra</option>
							</select>
							<br />
							<label>Color Scheme</label> <br />
							<select id="fractal_colors">
								<option selected="selected" value="rain">Rain</option>
								<option value="spec">Spectrum</option>
								<option value="temp">Temperature</option>
								<option value="grayscale">Grayscale</option>
							</select>

						</p>
					</td>
				</tr>
				<tr id="markov_options">
					<td colspan="3">
						<h3 style="clear: both;"> Icosa Options </h3>
						<p>
							<label>Level</label><br />
							<input type="text" id="markov_level" value="1" size="3" />
						</p>

						<p>
							<label>XY Min</label><br />
							<input type="text" id="markov_xymin" value="-5.0" size="3" /><br />
							<label>XY Max</label><br />
							<input type="text" id="markov_xymax" value="5.0" size="3" />
						</p>
						<p>
							<label>Size</label><br />
							<input type="text" id="markov_res" value="100" size="4" />
						</p>
					</td>
				</tr>
			</table>

			</td>
		</tr>
		
		
	</table>
	<div id="saveable"><img src="" /><br /><button id="close-saveable">Close</button></div>
	<script type="text/javascript">
		var MarkovWorker = new Worker('markov.js');
		MarkovWorker.onmessage = function (e) {
			if ( e.data instanceof String ) {

				alert(e.data);
			} else if ( e.data instanceof Object ) {
				if ( e.data.text == "Render" ) {
					Canvas.data = e.data.data;
					Canvas.draw();
				}
				if ( e.data.text == "UpdateProgress" ) {
					window.updateProgress( e.data.value );
				}
			}
		};

		var IcosaWorker = new Worker('icosahedron.js');
		IcosaWorker.onmessage = function (e) {
			if ( e.data instanceof String ) {
				alert(e.data);
			} else if ( e.data instanceof Object ) {
				if ( e.data.text == "Render" ) {
					Canvas.data = e.data.data;
					Canvas.draw();
				}
				if ( e.data.text == "UpdateProgress" ) {
					window.updateProgress( e.data.value );
				}
			}
		};

		(function ($) {
			window.updateProgress = function( percent ) {
				if ( percent > 100) {
					percent = 100;
				}
				$('#progress_bar').show();
				$('#progress_bar').css({ width:  percent + "%"});
				$('#progress_bar').html(percent + "%");
			}
			function updateVelocity() {
				var alpha = parseFloat( $('#alpha').val() );
				$('#velocity').val( 2 * alpha / (1 + Math.pow(alpha,2) ) );
			}
			function chooseFractalType() {
				window.Canvas.wipeOut();
				var t = $('#fractal_algorithm').val();
				if (t == "icosa") {
					IcosaWorker.postMessage({
						text:'Settings',
						settings: {
							iterations: $('#iterations').val(),
							alpha: $('#alpha').val(),
							fractal_type: $('#fractal_type').val(),
						}
					});
					IcosaWorker.postMessage({
						text:'Run'
					});
				} else if ( t == "markov" ) {
					MarkovWorker.postMessage({
						text:'Settings',
						settings: {
							markov_level: $('#markov_level').val(),
							markov_xymin: $('#markov_xymin').val(),
							markov_xymax: $('#markov_xymax').val(),
							markov_res: $('#markov_res').val()
						}
					});
					MarkovWorker.postMessage({
						text:'Run'
					});
				}
			}
			function chooseFractalRedraw() {
				window.Canvas.wipeOut();
				Canvas.draw();
			}
			$(function () {
				$canvas = document.getElementById("fractalCanvas");
				document.getElementById('generate').addEventListener( 'click', function () {
					chooseFractalType();
				}, false );
				$('#alpha').keyup(function () {
					updateVelocity();
				});
				updateVelocity();
				//chooseFractalType();
				$('#redraw_button').click(function () {
					chooseFractalRedraw();
				});
				$('#save_button').click(function () {
					var div = $('#saveable');
					var img = div.find('img');
					var cnvs = document.getElementById('fractalCanvas');
					var ctx = cnvs.getContext("2d");
					var myImage = cnvs.toDataURL("image/png");
					img.attr('src',myImage);
					div.show();
				});
				$('#close-saveable').click(function () {
					$('#saveable').hide();
				});

				$('#fractal_algorithm').change(function () {
					var t = $('#fractal_algorithm').val();
					if (t == 'markov') {
						$('#markov_options').show();
					} else {
						$('#markov_options').hide();
					}
				} );

			});
		})(jQuery);
	</script>
</body>
</html>