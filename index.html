<!DOCTYPE html>
<html>
<head>
	<title>Fractals of Arkadiusz Jadczyk</title>
	<style type="text/css">
	#progress_bar {
		width: 0px;
		height: 35px;
		display: none;
		background-color: #333;
	}
	#saveable {
		position: absolute;
		top: 5%;
		left: 10%;
		background-color: black;
		border: 2px solid white;
		display: none;
	}
	#markov_options {
		display: none;
	}
	#markov_options p {
		float: left;
		margin-right: 10px;
	}
	</style>
</head>
<body>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="array.js"></script>
	<script type="text/javascript" src="math.js"></script>
	<script type="text/javascript" src="colors.js"></script>
	<script type="text/javascript" src="canvas.js"></script>
	<script type="text/javascript" src="matrices.js"></script>
	<script type="text/javascript" src="icosahedron.js"></script>
	<script type="text/javascript" src="markov.js"></script>
	<table>
		<tr>
			<td valign="top">
				<canvas id="fractalCanvas" width="600px" height="600px"></canvas>
			</td>
		</tr>
		<tr>
			<td valign="top">
				
			<table>
				<tr>
					<td valign="top">
						<p>
							<label>Alpha</label><br />
							<input type="text" id="alpha" value="0.77" /> <br />
							<label>Velocity</label><br />
							<input type="text" id="velocity" value="0.77" />
						</p>
					</td>
					<td valign="top">
						<p>
							<label>Iterations</label> <br />
							<input type="text" id="iterations" value="100000" />
							<br />
							<label>Algorithm</label> <br />
							<select id="fractal_algorithm">
								<option selected="selected" value="icosa">Icosa</option>
								<option value="markov">Markov</option>
							</select>
						</p>
					</td>
					<td valign="top">
						<p>
							<label>Type</label> <br />
							<select id="fractal_type">
								<option>Para</option>
								<option>PlatonicCube</option>
								<option>PlatonicDodeca</option>
								<option selected="selected">PlatonicIcosa</option>
								<option>PlatonicOcta</option>
								<option>PlatonicTetra</option>
							</select>
							<br />
							<label>Color Scheme</label> <br />
							<select id="fractal_colors">
								<option selected="selected" value="rain">Rain</option>
								<option value="spec">Spectrum</option>
								<option value="temp">Temperature</option>
								<option value="grayscale">Grayscale</option>
							</select>

						</p>
					</td>
				</tr>
				<tr id="markov_options">
					<td colspan="3">
						<h3 style="clear: both;"> Markov Options </h3>
						<p>
							<label>Level</label><br />
							<input type="text" id="markov_level" value="1" size="3" />
						</p>

						<p>
							<label>XY Min</label><br />
							<input type="text" id="markov_xymin" value="-5.0" size="3" /><br />
							<label>XY Max</label><br />
							<input type="text" id="markov_xymax" value="5.0" size="3" />
						</p>
						<p>
							<label>Size</label><br />
							<input type="text" id="markov_res" value="100" size="4" />
						</p>
					</td>
				</tr>
			</table>

			</td>
		</tr>
		<tr>
			<td align="right">
				<button id="generate">Generate</button>
				<button id="redraw_button">Redraw</button>
				<button id="save_button">Save Image</button>
			</td>
		</tr>
		<tr>
			<td valign="top">
				<div id="progress_bar">&nbsp;</div>
			</td>
		</tr>
	</table>
	<div id="saveable"><img src="" /><br /><button id="close-saveable">Close</button></div>
	<script type="text/javascript">


		(function ($) {
			function updateVelocity() {
				var alpha = parseFloat( $('#alpha').val() );
				$('#velocity').val( 2 * alpha / (1 + Math.pow(alpha,2) ) );
			}
			function chooseFractalType() {
				window.Canvas.wipeOut();
				var t = $('#fractal_algorithm').val();
				if (t == "icosa") {
					generateFractal($canvas);
				} else if ( t == "markov" ) {
					Markov.generate();
				}
			}
			function chooseFractalRedraw() {
				window.Canvas.wipeOut();
				var t = $('#fractal_algorithm').val();
				if (t == "icosa") {
					reDrawFractal();
				} else if ( t == "markov" ) {
					Markov.redraw();
				}
			}
			$(function () {
				$canvas = document.getElementById("fractalCanvas");
				document.getElementById('generate').addEventListener( 'click', function () {
					chooseFractalType();
				}, false );
				$('#alpha').keyup(function () {
					updateVelocity();
				});
				updateVelocity();
				chooseFractalType();
				$('#redraw_button').click(function () {
					chooseFractalRedraw();
				});
				$('#save_button').click(function () {
					var div = $('#saveable');
					var img = div.find('img');
					var cnvs = document.getElementById('fractalCanvas');
					var ctx = cnvs.getContext("2d");
					var myImage = cnvs.toDataURL("image/png");
					img.attr('src',myImage);
					div.show();
				});
				$('#close-saveable').click(function () {
					$('#saveable').hide();
				});

				$('#fractal_algorithm').change(function () {
					var t = $('#fractal_algorithm').val();
					if (t == 'markov') {
						$('#markov_options').show();
					} else {
						$('#markov_options').hide();
					}
				} );

			});
		})(jQuery);
	</script>
</body>
</html>